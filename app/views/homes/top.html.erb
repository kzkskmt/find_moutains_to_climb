<body id="page-top">
    <!-- Masthead-->
    <header class="masthead">
        <div class="container px-4 px-lg-5 d-flex h-100 align-items-center justify-content-center">
            <div class="d-flex justify-content-center">
                <div class="text-center">
                    <h2 class="text-white-50 mx-auto mt-2">登りたい山がみつかるサービス</h2>
                    <h2 class="text-white mx-auto mb-5">「Find Mts」</h2>
                    <a class="btn btn-primary" href="#map">地図から探す</a>
                </div>
            </div>
        </div>
    </header>
    <!-- About-->
    <section class="about-section text-center" id="about">
        <div class="container px-4 px-lg-5">
            <div class="row gx-4 gx-lg-5 justify-content-center">
                <div class="col-lg-8">
                    <h2 class="text-white mb-4">「Find Mts」でできること</h2>
                    <p class="text-white-50">
                        山の検索から、登山の所要時間、登山口までのルート検索、
                        山の天気や服装の提案、周辺の宿泊施設他登山に関わる情報をまとめて調べることができます。
                        <a href="https://startbootstrap.com/theme/grayscale/">the preview page.</a>
                    </p>
                </div>
            </div>
        </div>
    </section>
    <!-- Maps-->
    <section class="map-section bg-light" id="map">
        <div class="container px-4 px-lg-5">
            <!-- Featured Map Row-->
            <div class="row gx-0 mb-4 mb-lg-5 align-items-center">
                <div class="col-xl-8 col-lg-7">
                    <!-- googlemapを埋め込む場所　-->
                    <div id='googlemap' style="height:420px" class='mb-3 mb-lg-0'></div>
                </div>
                <div class="col-xl-4 col-lg-5">
                    <div class="featured-text text-center text-lg-left">
                        <h4>地図から探す</h4>
                        <div class="input-group mb-3">
                            <input id="address" type="text" class="form-control" placeholder="地名">
                            <div class="input-group-append">
                                <input type="button" value="検索" onclick="codeAddress()" class="btn btn-outline-primary">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Map One Row-->
            <div class="row gx-0 mb-5 mb-lg-0 justify-content-center">
                <div class="col-lg-6"><%= image_tag 'img/demo-image-01.jpg', class: 'img-fluid' %></div>
                <div class="col-lg-6">
                    <div class="bg-black text-center h-100 map">
                        <div class="d-flex h-100">
                            <div class="map-text w-100 my-auto text-center text-lg-left">
                                <h4 class="text-white">Misty</h4>
                                <p class="mb-0 text-white-50">An example of where you can put an image of a project, or anything else, along with a description.</p>
                                <hr class="d-none d-lg-block mb-0 ms-0" />
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Map Two Row-->
            <div class="row gx-0 justify-content-center">
                <div class="col-lg-6"><%= image_tag 'img/demo-image-02.jpg', class: 'img-fluid' %></div>
                <div class="col-lg-6 order-lg-first">
                    <div class="bg-black text-center h-100 map">
                        <div class="d-flex h-100">
                            <div class="map-text w-100 my-auto text-center text-lg-right">
                                <h4 class="text-white">Mountains</h4>
                                <p class="mb-0 text-white-50">Another example of a project with its respective description. These sections work well responsively as well</p>
                                <hr class="d-none d-lg-block mb-0 me-0" />
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Signup-->
    <section class="signup-section" id="signup">
        <div class="container px-4 px-lg-5">
            <div class="row gx-4 gx-lg-5">
                <div class="col-md-10 col-lg-8 mx-auto text-center">
                    <i class="far fa-paper-plane fa-2x mb-2 text-white"></i>
                    <h2 class="text-white mb-5">Subscribe to receive updates!</h2>
                    <!-- * * * * * * * * * * * * * * *-->
                    <!-- * * SB Forms Contact Form * *-->
                    <!-- * * * * * * * * * * * * * * *-->
                    <!-- This form is pre-integrated with SB Forms.-->
                    <!-- To make this form functional, sign up at-->
                    <!-- https://startbootstrap.com/solution/contact-forms-->
                    <!-- to get an API token!-->
                    <form class="form-signup" id="contactForm" data-sb-form-api-token="API_TOKEN">
                        <!-- Email address input-->
                        <div class="row input-group-newsletter">
                            <div class="col"><input class="form-control" id="emailAddress" type="email" placeholder="Enter email address..." aria-label="Enter email address..." data-sb-validations="required,email" /></div>
                            <div class="col-auto"><button class="btn btn-primary disabled" id="submitButton" type="submit">Notify Me!</button></div>
                        </div>
                        <div class="invalid-feedback mt-2" data-sb-feedback="emailAddress:required">An email is required.</div>
                        <div class="invalid-feedback mt-2" data-sb-feedback="emailAddress:email">Email is not valid.</div>
                        <!-- Submit success message-->
                        <!---->
                        <!-- This is what your users will see when the form-->
                        <!-- has successfully submitted-->
                        <div class="d-none" id="submitSuccessMessage">
                            <div class="text-center mb-3 mt-2 text-white">
                                <div class="fw-bolder">Form submission successful!</div>
                                To activate this form, sign up at
                                <br />
                                <a href="https://startbootstrap.com/solution/contact-forms">https://startbootstrap.com/solution/contact-forms</a>
                            </div>
                        </div>
                        <!-- Submit error message-->
                        <!---->
                        <!-- This is what your users will see when there is-->
                        <!-- an error submitting the form-->
                        <div class="d-none" id="submitErrorMessage"><div class="text-center text-danger mb-3 mt-2">Error sending message!</div></div>
                    </form>
                </div>
            </div>
        </div>
    </section>
    <!-- Contact-->
    <section class="contact-section bg-black">
        <div class="container px-4 px-lg-5">
            <div class="row gx-4 gx-lg-5">
                <div class="col-md-4 mb-3 mb-md-0">
                    <div class="card py-4 h-100">
                        <div class="card-body text-center">
                            <i class="fas fa-map-marked-alt text-primary mb-2"></i>
                            <h4 class="text-uppercase m-0">Address</h4>
                            <hr class="my-4 mx-auto" />
                            <div class="small text-black-50">4923 Market Street, Orlando FL</div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-3 mb-md-0">
                    <div class="card py-4 h-100">
                        <div class="card-body text-center">
                            <i class="fas fa-envelope text-primary mb-2"></i>
                            <h4 class="text-uppercase m-0">Email</h4>
                            <hr class="my-4 mx-auto" />
                            <div class="small text-black-50"><a href="#!">hello@yourdomain.com</a></div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-3 mb-md-0">
                    <div class="card py-4 h-100">
                        <div class="card-body text-center">
                            <i class="fas fa-mobile-alt text-primary mb-2"></i>
                            <h4 class="text-uppercase m-0">Phone</h4>
                            <hr class="my-4 mx-auto" />
                            <div class="small text-black-50">+1 (555) 902-8832</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="social d-flex justify-content-center">
                <a class="mx-2" href="#!"><i class="fab fa-twitter"></i></a>
                <a class="mx-2" href="#!"><i class="fab fa-facebook-f"></i></a>
                <a class="mx-2" href="#!"><i class="fab fa-github"></i></a>
            </div>
        </div>
    </section>

    <script>
    let map
    let marker = []
    let infoWindow = []
    // マーカーを消すためのcurrentInfoWindow
    let currentInfoWindow
    // mountainデータを格納する箱 markerData
    let markerData = []
    // markerDataにmountainデータをループ処理で格納
    <% @mountains.each do |mountain| %>
        var obj = {
        id: <%= mountain.id %>,
        name: '<%= mountain.name %>',
        lat: <%= mountain.peak_location_lat %>,
        lng: <%= mountain.peak_location_lng %>
        };
        markerData.push(obj)
    <% end %>
    let geocoder

    // 「InvalidValueError: initMap is not a function」への対策
    window.onload = function () {
        initMap();
    }

    function initMap(){
        // geocoderを初期化
        geocoder = new google.maps.Geocoder()

        // 地図の作成、中心位置の設定
        map = new google.maps.Map(document.getElementById('googlemap'), {
        center: { lat: 38.258595, lng: 137.6850225 }, // 日本の中心に緯度経度を設定
        zoom: 5
        });
        
        // markerDataに入っているデータのピンを立てる。
        for (var i = 0; i < markerData.length; i++) {
        markerLatLng = new google.maps.LatLng({lat: markerData[i]['lat'], lng: markerData[i]['lng']}); // 緯度経度のデータ作成
        marker[i] = new google.maps.Marker({ // マーカーの追加
            position: markerLatLng, // マーカーを立てる位置を指定
            map: map // マーカーを立てる地図を指定
        });

        // マーカーに表示する内容を設定
        var contentStr = 
            '<div class="map">' +
            '<a href="/mountains/' + markerData[i]['id'] + '">' +
            markerData[i]['name'] +
            '</a>' +
            '</div>'
            ;

        // 吹き出しの追加
        infoWindow[i] = new google.maps.InfoWindow({
            content: contentStr // 吹き出しに表示する内容をセット
        });

        markerEvent(i); // マーカーにクリックイベントを追加
        }
    }

    // マーカーにクリックイベントを追加
    function markerEvent(i) {
        marker[i].addListener('click', function() { // マーカーをクリックしたとき
        if (currentInfoWindow) { // 表示している吹き出しがあれば閉じる
            currentInfoWindow.close();
        }
        infoWindow[i].open(map, marker[i]); // 吹き出しの表示
        currentInfoWindow = infoWindow[i]
        });
    }

    function codeAddress(){
        // 入力を取得
        let inputAddress = document.getElementById('address').value;

        // geocodingしたあとmapを移動
        geocoder.geocode( { 'address': inputAddress}, function(results, status) {
        if (status == 'OK') {
            // map.setCenterで地図が移動
            map.setCenter(results[0].geometry.location);
            map.setZoom(10);
        } else {
            alert('Geocode was not successful for the following reason: ' + status);
        }
        });
    }
    </script>
    <!-- GoogleMaps JS API-->
    <script src="https://maps.googleapis.com/maps/api/js?language=ja&region=JP&key=<%= ENV["GOOGLE_MAP_API_KEY"]%>&callback=initMap" async defer></script>
</body>